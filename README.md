# Lumia AI - –ö—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –¥–æ–º–µ–Ω–∞–º–∏ `auth.lumiaai.ru` –∏ `chat.lumiaai.ru`.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–æ–≤
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã DNS –∑–∞–ø–∏—Å–∏:
```
auth.lumiaai.ru ‚Üí –í–∞—à —Å–µ—Ä–≤–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
chat.lumiaai.ru ‚Üí –í–∞—à —Å–µ—Ä–≤–µ—Ä —á–∞—Ç–∞
```

### 2. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
–û–±–∞ –¥–æ–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å secure cookies.

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
npm install
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
npm run db:migrate
```

### 5. –ó–∞–ø—É—Å–∫
```bash
# –î–ª—è –¥–æ–º–µ–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
npm run dev -- --port 3000

# –î–ª—è –¥–æ–º–µ–Ω–∞ —á–∞—Ç–∞ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
npm run dev -- --port 3001
```

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ chat.lumiaai.ru**
   - Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∫—É–∫–∏
   - –ï—Å–ª–∏ –∫—É–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `auth.lumiaai.ru/login?redirect=...`

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –Ω–∞ auth.lumiaai.ru**
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∫—É–∫–∏ —Å –¥–æ–º–µ–Ω–æ–º `.lumiaai.ru`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `chat.lumiaai.ru`

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –Ω–∞ chat.lumiaai.ru**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `AutoLogin` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—É–∫–∏ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —á–∞—Ç—É

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ login/page.tsx          # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ register/page.tsx       # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/route.ts       # API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register/route.ts   # API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auto-login/route.ts # API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout/route.ts     # API –≤—ã—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ (chat)/                 # –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —á–∞—Ç–∞
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ auth-form.tsx           # –§–æ—Ä–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ auto-login.tsx          # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ auth-guard.tsx          # –ó–∞—â–∏—Ç–∞ —Ä–æ—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ sign-out-form.tsx       # –§–æ—Ä–º–∞ –≤—ã—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cookies.ts          # –†–∞–±–æ—Ç–∞ —Å –∫—É–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cross-domain.ts     # –ö—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ auth.ts                 # –§—É–Ω–∫—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ middleware.ts               # Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ CROSS_DOMAIN.md         # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ†Ô∏è API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```http
POST /api/auth
Content-Type: application/json

{
  "nickname": "username",
  "password": "password",
  "rememberMe": false,
  "redirect": "https://chat.lumiaai.ru/some-page"
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
```http
POST /api/register
Content-Type: application/json

{
  "email": "user@example.com",
  "nickname": "username",
  "password": "password",
  "rememberMe": false
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
```http
POST /api/auto-login
```

### –í—ã—Ö–æ–¥
```http
POST /api/logout
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö—É–∫–∏
- –î–æ–º–µ–Ω: `.lumiaai.ru` (–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö)
- SameSite: `lax` (–¥–ª—è –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
- Secure: `true` (–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ)
- HttpOnly: `false` (–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)

### –¢–æ–∫–µ–Ω—ã
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–æ–¥–µ—Ä–∂–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –∏ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É
- –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JWT

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
npm run test:auth

# –¢–µ—Å—Ç—ã —á–∞—Ç–∞
npm run test:chat

# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –¢–µ—Å—Ç –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
node scripts/test-auth.js
```

## üêõ Troubleshooting

### –ö—É–∫–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞

### –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ middleware
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä redirect –≤–∞–ª–∏–¥–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫—É–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API auto-login —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ [docs/CROSS_DOMAIN.md](docs/CROSS_DOMAIN.md)

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. Fork —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE) —Ñ–∞–π–ª –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
